<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Druvienas ‚Äî mƒÅjas lietotne</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--bg:#0f1115;--panel:#141820;--ink:#e8eaee;--muted:#9aa3b2;--border:#1f2532;--accent:#4b8cff}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .app{max-width:1100px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;position:sticky;top:0;background:var(--bg);z-index:5}
    .title{margin:0;font-weight:800}
    .lang{display:flex;gap:8px}
    .btn{border:1px solid var(--border);background:#121723;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.active{outline:2px solid var(--accent)}
    .layout{display:grid;grid-template-columns:340px 1fr;gap:16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:14px}

    /* –î–æ–º: –±–æ–ª—å—à–æ–π –Ω–∞ –≥–ª–∞–≤–Ω–æ–π, –º–∞–ª–µ–Ω—å–∫–∏–π –≤ —É–≥–ª—É –≤ —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    .houseCard{position:relative;min-height:260px}
    .houseBox{display:flex;align-items:center;justify-content:center;min-height:240px}
    .houseImg{width:78%;max-width:300px;height:auto;border-radius:10px;display:block;cursor:pointer;transition:.25s ease}
    .hint{color:var(--muted);font-size:12px;text-align:center;margin-top:6px}

    /* –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º ‚Äî –¥–æ–º –∫–∞–∫ ¬´Home¬ª-–∫–Ω–æ–ø–∫–∞ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É */
    body.compact .houseCard{min-height:120px}
    body.compact .houseBox{min-height:100px}
    body.compact .houseImg{
      width:96px;max-width:none;position:absolute;right:12px;top:12px;border-radius:8px;
      box-shadow:0 8px 24px rgba(0,0,0,.35)
    }
    body.compact .hint{display:none}

    .menuItem{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#121723;cursor:pointer;margin-bottom:10px}
    .menuItem:hover{outline:2px solid rgba(75,140,255,.5)}
    .sectionTitle{font-weight:800;margin:0 0 8px}
    .sectionText{color:var(--muted);line-height:1.5}
    .error{color:#ffb4b4;background:#381b1b;border:1px solid #5b2a2a;padding:10px 12px;border-radius:10px;display:none}

    @media (max-width:900px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h3 id="pageTitle" class="title">Druvienas iela 36 ‚Äî <span id="userName">‚Ä¶</span></h3>
      <div class="lang">
        <button id="ruBtn" class="btn">üá∑üá∫ RU</button>
        <button id="lvBtn" class="btn">üá±üáª LV</button>
      </div>
    </header>

    <div class="layout">
      <!-- –î–æ–º / Home -->
      <div class="card houseCard">
        <div class="houseBox">
          <img id="houseImg" class="houseImg" src="images/house.png" alt="Home" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω">
        </div>
        <div id="homeHint" class="hint">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –¥–æ–º, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</div>
      </div>

      <!-- –ú–µ–Ω—é + –∫–æ–Ω—Ç–µ–Ω—Ç -->
      <div class="card">
        <div id="menu"></div>
        <hr style="border:none;border-top:1px solid var(--border);margin:12px 0">
        <div>
          <div id="contentTitle" class="sectionTitle"></div>
          <div id="contentText" class="sectionText"></div>
          <div id="errorBox" class="error"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Telegram bootstrap
    const tg = window.Telegram?.WebApp; tg?.ready(); tg?.expand();
    const user = tg?.initDataUnsafe?.user;
    const userNameEl = document.getElementById('userName');
    userNameEl.textContent = user?.first_name || user?.username ? (user?.username ? '@'+user.username : user.first_name) : 'guest';

    // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
    const DICT = {
      ru: {
        appTitle: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–æ–º–∞',
        menu: [
          { id:'results', ru:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π', lv:'Balso≈°anas rezultƒÅti' },
          { id:'docs',    ru:'–î–æ–∫—É–º–µ–Ω—Ç—ã',               lv:'Dokumenti' },
          { id:'qa',      ru:'–í–æ–ø—Ä–æ—Å—ã / –û—Ç–≤–µ—Ç—ã',        lv:'JautƒÅjumi / Atbildes' },
          { id:'works',   ru:'–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ä–∞–±–æ—Ç—ã',      lv:'PlƒÅnotie darbi' },
        ],
        stub: {
          results: '–ó–¥–µ—Å—å –±—É–¥—É—Ç –∏—Ç–æ–≥–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π –ø–æ –¥–æ–º—É –∏ –ø–æ–¥—ä–µ–∑–¥–∞–º.',
          docs:    '–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.',
          qa:      '–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞.',
          works:   'Under construction ‚Äî —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç!'
        }
      },
      lv: {
        appTitle: 'MƒÅjas lietotne',
        menu: [
          { id:'results', ru:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π', lv:'Balso≈°anas rezultƒÅti' },
          { id:'docs',    ru:'–î–æ–∫—É–º–µ–Ω—Ç—ã',               lv:'Dokumenti' },
          { id:'qa',      ru:'–í–æ–ø—Ä–æ—Å—ã / –û—Ç–≤–µ—Ç—ã',        lv:'JautƒÅjumi / Atbildes' },
          { id:'works',   ru:'–ü–ª–∞–Ωƒìtie darbi',          lv:'PlƒÅnotie darbi' },
        ],
        stub: {
          results: '≈†eit b≈´s balso≈°anas rezultƒÅti pa mƒÅju un kƒÅp≈Üutelpu.',
          docs:    '≈†eit b≈´s dokumentu saraksts.',
          qa:      'Uzdodiet jautƒÅjumu un sekojiet atbildei.',
          works:   'Under construction ‚Äî drƒ´zumƒÅ!'
        }
      }
    };

    const state = { lang:'ru', active:null };
    const $ = s => document.querySelector(s);

    const ruBtn=$('#ruBtn'), lvBtn=$('#lvBtn');
    const menuBox=$('#menu'), pageTitle=$('#pageTitle');
    const contentTitle=$('#contentTitle'), contentText=$('#contentText'), errorBox=$('#errorBox');
    const houseImg=$('#houseImg');

    // init lang from Telegram or query
    const qsLang = new URLSearchParams(location.search).get('lang');
    state.lang = (qsLang || tg?.initDataUnsafe?.user?.language_code || 'ru').toLowerCase().startsWith('lv') ? 'lv' : 'ru';

    ruBtn.onclick = ()=>{ setLang('ru'); };
    lvBtn.onclick = ()=>{ setLang('lv'); };

    houseImg.onclick = goHome;

    function setLang(lang){
      state.lang = lang === 'lv' ? 'lv' : 'ru';
      ruBtn.classList.toggle('active', state.lang==='ru');
      lvBtn.classList.toggle('active', state.lang==='lv');
      pageTitle.firstChild.nodeValue = (state.lang==='lv' ? 'Druvienas iela 36 ‚Äî ' : 'Druvienas iela 36 ‚Äî ');
      renderMenu();
      if (state.active) openSection(state.active); // –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π
    }

    function renderMenu(){
      const L = DICT[state.lang];
      document.title = L.appTitle;
      menuBox.innerHTML = '';
      L.menu.forEach(item=>{
        const el=document.createElement('div');
        el.className='menuItem';
        el.dataset.id=item.id;
        el.innerHTML=`<span>${state.lang==='lv' ? item.lv : item.ru}</span><span>‚Ä∫</span>`;
        el.onclick=()=> openSection(item.id);
        menuBox.appendChild(el);
      });
    }

    function goHome(){
      state.active = null;
      document.body.classList.remove('compact');
      contentTitle.textContent = '';
      contentText.textContent  = '';
      errorBox.style.display = 'none';
    }

    function openSection(id){
      state.active = id;
      document.body.classList.add('compact'); // —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –¥–æ–º –≤ —É–≥–æ–ª

      const L = DICT[state.lang];
      const item = L.menu.find(m=>m.id===id);
      const title = state.lang==='lv' ? item.lv : item.ru;
      contentTitle.textContent = title;

      // –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Å–µ–∫—Ü–∏—è–º
      if (id === 'results') {
        // –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º results.html –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        contentText.innerHTML = `<iframe src="results.html?v=${Date.now()}" style="width:100%;height:520px;border:1px solid var(--border);border-radius:12px;"></iframe>`;
      } else if (id === 'docs') {
        contentText.textContent = L.stub.docs;
      } else if (id === 'qa') {
        contentText.textContent = L.stub.qa;
      } else if (id === 'works') {
        contentText.innerHTML = `<div style="padding:12px;border:1px dashed var(--border);border-radius:12px">${L.stub.works}</div>`;
      } else {
        contentText.textContent = '';
      }
    }

    // boot
    setLang(state.lang);
  </script>
</body>
</html>
